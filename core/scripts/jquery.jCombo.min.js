/*
 * jQuery jCombo Plugin (Minified)
 * Carlos De Oliveira
 * cardeol@gmail.com
 *
 * Latest Release: Sep 2011 
 */
(function(a){
    a.fn.jCombo=function(b,d){
        function h(b,d,e,f,g,h){
            // TODO: get ajax function out of the plugin
            a.ajax({
                type:"GET",
                dataType:"json",
                url:d+e,
                success:function(a){
                    var d="";
                    if(a.totalRows==0){
                        d+='<option value="0"></option>';
                        b.html(d)
                    }else{
                        if(f!=""&&f!=null){
                            d+='<option value="0">'+f+"</option>"
                        }
                        $.each(a.result, function(e, fi){
                            var s;
                            if (h!=""){
                                s=fi.name==h?' selected="selected"':"";
                            }else{
                                s=fi.id==g?' selected="selected"':"";
                            }
                            d+='<option value="'+fi.id+'"'+s+">"+fi.name+"</option>"
                        });
                        b.html(d)
                    }
                    b.trigger("change")
                }
            })
        }
        var e={
            parent:"",
            selected_value:"0",
            selected_name:"",
            parent_value:"",
            initial_text:"-- Seleccionar --"
        };
    
        var d=a.extend(e,d);
        var f=a(this);
        if(d.parent!=""){
            var g=a(d.parent);
            g.removeAttr("disabled","disabled");
            g.bind("change",function(c){
                f.attr("disabled","disabled");
                if(a(this).val()!="0"&&a(this).val()!="")f.removeAttr("disabled");
                h(f,b,a(this).val(),d.initial_text,d.selected_value,d.selected_name)
            })
        }
        h(f,b,d.parent_value,d.initial_text,d.selected_value,d.selected_name)
    }
})(jQuery)